import{f as c,k as j,e as E,d as _,u as n,S as O,a3 as P,W as T,o as q,b as H,F,ab as V,ac as l,a4 as I,V as U}from"./vue-db0e7353.js";import{ap as N,a6 as y,aq as B,ar as W,as as M,at as Y,au as J,av as Q,a0 as X,aw as Z,a1 as K}from"./index-a3873c66.js";import"./dayjs-4778c158.js";import{D as ee}from"./DarkModeToggle-b763d2ce.js";import{C as te}from"./Card-3e30f616.js";import"./mockjs-890b569b.js";import"./useFlexGapSupport-a31804f7.js";var oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"};const re=oe;function z(o){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},r=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),r.forEach(function(s){ne(o,s,t[s])})}return o}function ne(o,e,t){return e in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}var C=function(e,t){var r=z({},e,t.attrs);return c(N,z({},r,{icon:re}),null)};C.displayName="LockOutlined";C.inheritAttrs=!1;const L=C;var se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"};const ae=se;function A(o){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},r=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),r.forEach(function(s){ie(o,s,t[s])})}return o}function ie(o,e,t){return e in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}var D=function(e,t){var r=A({},e,t.attrs);return c(N,A({},r,{icon:ae}),null)};D.displayName="MailOutlined";D.inheritAttrs=!1;const k=D,ce="/ui/assets/login-box-bg-9027741f.svg";var p=(o=>(o[o.LOGIN=0]="LOGIN",o[o.REGISTER=1]="REGISTER",o[o.RESET_PASSWORD=2]="RESET_PASSWORD",o))(p||{});const G=j(0);function R(){function o(r){G.value=r}const e=E(()=>G.value);function t(){o(0)}return{setLoginState:o,getLoginState:e,handleBackLogin:t}}const le={class:"mb-3 text-2xl font-bold text-center xl:text-3xl enter-x xl:text-left color-text"},$=_({__name:"login-form-title",setup(o){const{t:e}=y(),{getLoginState:t}=R(),r=E(()=>({[p.RESET_PASSWORD]:e("sys.login.forgetFormTitle"),[p.LOGIN]:e("sys.login.signInFormTitle"),[p.REGISTER]:e("sys.login.signUpFormTitle")})[n(t)]);return(s,d)=>(O(),P("h2",le,T(n(r)),1))}}),me=_({__name:"login-form",setup(o){const{t:e}=y(),{setLoginState:t,getLoginState:r}=R(),s=E(()=>n(r)===p.LOGIN),d={type:"object",properties:{mail:{type:"string","x-decorator":"FormItem","x-component":"Input","x-component-props":{size:"large",allowClear:!0,placeholder:e("sys.login.mailPlaceholder")},"x-content":{prefix:k},"x-validator":{required:!0,format:"email"},default:"178529795@qq.com"},password:{type:"string","x-decorator":"FormItem","x-component":"Password","x-component-props":{size:"large",allowClear:!0,placeholder:e("sys.login.passwordPlaceholder")},"x-content":{prefix:L},required:!0,default:"dexter"},submit:{type:"void","x-component":"Button","x-component-props":{size:"large",block:!0,type:"primary","@click":()=>u()},"x-reactions":{fulfill:{schema:{"x-component-props.loading":"{{ $form.submitting }}"}}},"x-content":e("sys.login.loginButton")},group:{type:"void","x-component":"FormButtonGroup","x-component-props":{align:"right",style:"margin-top: 6px",gutter:0},properties:{register:{"x-component":"Button","x-component-props":{type:"link",onClick:()=>t(p.REGISTER)},"x-content":e("sys.login.registerButton")},forgetPassword:{"x-component":"Button","x-component-props":{type:"link",onClick:()=>t(p.RESET_PASSWORD)},"x-content":e("sys.login.forgetPassword")}}}}},{FormilyForm:h,submit:w,form:m}=B({schema:d}),{notification:v}=M(),g=W(),u=async()=>{const a=await w();if(a)try{m.submitting=!0;const i=await g.login({mail:a.mail,password:a.password});i&&v.success({message:e("sys.login.loginSuccessTitle"),description:`${e("sys.login.loginSuccessDesc")}: ${i.nickname||i.mail}`,duration:3})}catch(i){console.error(`login-error: ${i}`)}finally{m.submitting=!1}},f=a=>{a.keyCode===13&&s.value&&u()};return q(()=>{window.addEventListener("keydown",f)}),H(()=>{window.removeEventListener("keydown",f)}),(a,i)=>n(s)?(O(),P(F,{key:0},[c($,{class:"enter-x"}),c(n(h))],64)):V("",!0)}}),{t:pe}=y(),ue=()=>c("span",{class:"color-primary"},[pe("sys.login.resetPasswordTip")]),de=_({__name:"forget-password-form",setup(o){const{t:e}=y(),{handleBackLogin:t,getLoginState:r}=R(),s=E(()=>n(r)===p.RESET_PASSWORD),d={type:"object",properties:{mail:{type:"string","x-decorator":"FormItem","x-component":"Input","x-component-props":{size:"large",allowClear:!0,placeholder:e("sys.login.mailPlaceholder")},"x-content":{prefix:k},"x-validator":{required:!0,format:"email"}},submit:{type:"void","x-decorator":"FormItem","x-decorator-props":{extra:ue()},"x-component":"Button","x-component-props":{size:"large",block:!0,type:"primary","@click":()=>g()},"x-reactions":{fulfill:{schema:{"x-component-props.loading":"{{ $form.submitting }}"}}},"x-content":e("sys.login.resetButton")},back:{type:"void","x-decorator":"FormItem","x-component":"Button","x-component-props":{size:"large",block:!0,"@click":()=>t()},"x-content":e("sys.login.backSignIn")}}},{FormilyForm:h,submit:w,form:m}=B({schema:d}),{notification:v}=M(),g=async()=>{const u=await w();if(u)try{m.submitting=!0,await Y({mail:u.mail}),v.success({message:e("sys.login.resetSuccessTitle"),description:e("sys.login.resetSuccessDesc"),duration:3}),t()}catch(f){console.error(`login-error: ${f}`)}finally{m.submitting=!1}};return(u,f)=>n(s)?(O(),P(F,{key:0},[c($,{class:"enter-x"}),c(n(h))],64)):V("",!0)}}),ge=_({__name:"register-form",setup(o){const{t:e}=y(),{handleBackLogin:t,getLoginState:r}=R(),s=E(()=>n(r)===p.REGISTER),d={type:"object",properties:{mail:{type:"string","x-decorator":"FormItem","x-component":"Input","x-component-props":{size:"large",allowClear:!0,placeholder:e("sys.login.mailPlaceholder")},"x-content":{prefix:k},"x-validator":{required:!0,format:"email"}},verifycode:{type:"string","x-decorator":"FormItem","x-component":"CountDownInput","x-component-props":{size:"large",allowClear:!0,sendCodeApi:()=>u(),btnProps:{type:"primary"},placeholder:e("sys.login.verifycodePlaceholder")},"x-content":{prefix:k},required:!0},password:{type:"string","x-decorator":"FormItem","x-component":"Password","x-component-props":{size:"large",allowClear:!0,placeholder:e("sys.login.passwordPlaceholder")},"x-content":{prefix:L},required:!0},password2:{type:"string","x-decorator":"FormItem","x-component":"Password","x-component-props":{size:"large",allowClear:!0,placeholder:e("sys.login.password2Placeholder")},"x-content":{prefix:L},required:!0,"x-validator":{validator:(a,i,x)=>{var b,S;return!a||!((b=x.form.values)!=null&&b.password)?"":((S=x.form.values)==null?void 0:S.password)!==a?i.message:""},message:e("sys.login.diffPwd")},"x-reactions":{dependencies:["password"],fulfill:{run:"$values?.password2 && $form.validate('password2')"}}},submit:{type:"void","x-decorator":"FormItem","x-component":"Button","x-component-props":{size:"large",block:!0,type:"primary","@click":()=>f()},"x-reactions":{fulfill:{schema:{"x-component-props.loading":"{{ $form.submitting }}"}}},"x-content":e("sys.login.registerButton")},back:{type:"void","x-decorator":"FormItem","x-component":"Button","x-component-props":{size:"large",block:!0,"@click":()=>t()},"x-content":e("sys.login.backSignIn")}}},{FormilyForm:h,submit:w,form:m}=B({schema:d}),{notification:v,createMessage:g}=M(),u=()=>new Promise(async(a,i)=>{var b,S;const x=m.getValuesIn("mail");if(!x||(S=(b=m.getFieldState("mail"))==null?void 0:b.errors)!=null&&S.length)return g.destroy(),g.error("请先填写正确的邮箱"),i(!1);J({mail:x}).then(()=>(g.success(`验证码已发送到邮箱：${x}，请注意查收`),a(!0))).catch(()=>i(!1))}),f=async()=>{const a=await w();if(a)try{m.submitting=!0,await Q({mail:a.mail,verifycode:a.verifycode,password:a.password}),v.success({message:e("sys.login.registerSuccessTitle"),description:e("sys.login.registerSuccessDesc"),duration:3}),t()}catch(i){console.error(`login-error: ${i}`)}finally{m.submitting=!1}};return(a,i)=>n(s)?(O(),P(F,{key:0},[c($,{class:"enter-x"}),c(n(h))],64)):V("",!0)}}),fe=["title","alt"],xe={class:"my-auto"},_e=["alt"],ye={class:"mt-10 font-medium text-white -enter-x"},he={class:"inline-block mt-4 text-2xl"},we={class:"mt-4 font-normal text-white text-md -enter-x"},ve={class:"absolute mt-4 right-4"},be={class:"sm:w-4/6 xl:w-4/5 w-full mx-auto my-auto p-4 rounded-md shadow-md xl:shadow-none"},Se=_({name:"Login"}),Le=_({...Se,setup(o){const{bem:e}=K("login"),{title:t}=X({VITE_PORT:"3000",VITE_GLOB_APP_TITLE:"Monibuca Admin",VITE_GLOB_APP_SHORT_NAME:"m7s_admin",VITE_USE_MOCK:"true",VITE_PUBLIC_PATH:"/ui",VITE_DROP_CONSOLE:"true",VITE_BUILD_COMPRESS:"none",VITE_BUILD_COMPRESS_DELETE_ORIGIN_FILE:"false",VITE_GLOB_HTTP_REFRESH_TIME:"5000",VITE_USE_IMAGEMIN:"true",VITE_LEGACY:"false",VITE_M7S_SERVER:"",BASE_URL:"/ui",MODE:"production",DEV:!1,PROD:!0,SSR:!1}),{t:r}=y();return(s,d)=>(O(),P("div",{class:I(n(e)())},[l("div",{class:I([n(e)("slogan"),"hidden xl:flex"])},[l("div",{class:I(n(e)("logo"))},[l("img",{title:n(t),alt:n(t),src:Z},null,8,fe),l("div",{class:I([n(e)("logo-title"),"truncate"])},T(n(t)),3)],2),l("div",xe,[l("img",{alt:n(t),src:ce,class:"w-2/3 -enter-x"},null,8,_e),l("div",ye,[l("span",he,T(n(r)("sys.login.signInTitle")),1)]),l("div",we,T(n(r)("sys.login.signInDesc")),1)])],2),l("div",{class:I([n(e)("form"),"enter-x"])},[l("div",ve,[c(n(ee))]),l("div",be,[c(n(te),null,{default:U(()=>[c(me),c(de),c(ge)]),_:1})])],2)],2))}});export{Le as default};
