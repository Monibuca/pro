import{d as g,f as e,e as N,U as F,V as k,u as t,$ as x,E as f,F as B,g as K}from"./vue-0f3866c3.js";import{u as j}from"./formily-0e145bc1.js";import{u as G,h as T,m as I,P as S,T as z,B as M,al as V,am as Y,an as q,Y as X,ao as J,ap as O}from"./index-0f1216c0.js";import{u as H,a as Q}from"./index-2339cc6f.js";import"./dayjs-4778c158.js";import{_ as W,u as Z}from"./usePlay-f4275dfe.js";import{s as ee}from"./jb4-df322d33.js";import{D as te}from"./index-b778e87c.js";import{u as ie}from"./device-1d29c212.js";import{C as v}from"./Card-b011a411.js";import{S as ae}from"./index-5531bca5.js";import"./index-1881fc2c.js";import"./index-dd92d4d1.js";import"./index-4393de8e.js";import"./index-ae87ec0e.js";import"./Checkbox-97923aad.js";import"./mockjs-890b569b.js";import"./index-4409a03f.js";import"./index-3a414516.js";import"./useFlexGapSupport-341b3ecd.js";import"./index-a3a00587.js";var ne=function(){return{prefixCls:String,title:S.any,description:S.any,avatar:S.any}};const L=g({compatConfig:{MODE:3},name:"ACardMeta",props:ne(),slots:["title","description","avatar"],setup:function(o,d){var l=d.slots,u=G("card",o),r=u.prefixCls;return function(){var s=T({},"".concat(r.value,"-meta"),!0),i=I(l,o,"avatar"),c=I(l,o,"title"),y=I(l,o,"description"),h=i?e("div",{class:"".concat(r.value,"-meta-avatar")},[i]):null,p=c?e("div",{class:"".concat(r.value,"-meta-title")},[c]):null,C=y?e("div",{class:"".concat(r.value,"-meta-description")},[y]):null,w=p||C?e("div",{class:"".concat(r.value,"-meta-detail")},[p,C]):null;return e("div",{class:s},[h,w])}}});var re=function(){return{prefixCls:String,hoverable:{type:Boolean,default:!0}}};const A=g({compatConfig:{MODE:3},name:"ACardGrid",__ANT_CARD_GRID:!0,props:re(),setup:function(o,d){var l=d.slots,u=G("card",o),r=u.prefixCls,s=N(function(){var i;return i={},T(i,"".concat(r.value,"-grid"),!0),T(i,"".concat(r.value,"-grid-hoverable"),o.hoverable),i});return function(){var i;return e("div",{class:s.value},[(i=l.default)===null||i===void 0?void 0:i.call(l)])}}});v.Meta=L;v.Grid=A;v.install=function(a){return a.component(v.name,v),a.component(L.name,L),a.component(A.name,A),a};const oe=a=>({type:"object",properties:{layout:{type:"void","x-component":"FormLayout","x-component-props":{layout:"inline"},properties:{Name:{type:"string","x-decorator":"FormItem","x-decorator-props":{style:"margin-right: 10px;width: 260px"},"x-component":"Input","x-component-props":{placeholder:"请输入设备编号或名称搜索","@keyup":a},"x-content":{prefix:()=>e(z,{icon:"ic:outline-search"},null)}}}}}}),le=g({name:"Channel"}),se=g({...le,props:{detail:null,device:null},setup(a){const o=a,d={0:"空闲",1:"拉流中",2:"已拉流"},l=H(),u={maxHeight:"530px",rowConfig:{keyField:"DeviceID",useKey:!0},columnConfig:{useKey:!0},columns:[{field:"DeviceID",title:"编号",showOverflow:"tooltip",width:"200px",fixed:"left"},{field:"Name",title:"名称",showOverflow:"tooltip",width:"120px",fixed:"left"},{field:"Status",title:"状态",minWidth:"100px"},{field:"LiveStatus",title:"拉流状态",minWidth:"120px",formatter:({cellValue:s})=>d[s]},{field:"Manufacturer",title:"厂商",width:"120px"},{field:"Address",title:"地址",showOverflow:"tooltip",width:"180px"},{field:"Port",title:"端口",width:"70px"},{field:"Model",title:"型号",width:"180px"},{field:"Owner",title:"Owner",width:"120px"},{field:"CivilCode",title:"CivilCode",width:"120px"},{field:"Parental",title:"Parental",width:"120px"},{field:"SafetyWay",title:"SafetyWay",width:"120px"},{field:"RegisterWay",title:"RegisterWay",width:"120px"},{field:"Secrecy",title:"Secrecy",width:"120px"},{field:"operate",title:"操作",width:"140px",slots:{default:"operate"},align:"center",fixed:"right"}],data:o.detail},r=async s=>{const{DeviceID:i,Name:c}=s;await ee({id:o.device.ID,channel:i}).then(y=>{const h=o.detail.map(p=>(p.DeviceID===i&&(p.LiveStatus=0),p));l.tableRef.reloadData(h),Y.success(`通道 ${c||i} 已停止拉流`)})};return(s,i)=>(F(),k(B,null,[e(t(W)),e(t(V),{uid:t(l).uid,gridOptions:t(u)},{operate:x(({row:c})=>[e(t(M),{size:"small",type:"link",onClick:()=>t(Z)({id:a.device.ID,deviceName:a.device.Name,deviceID:c.DeviceID,channelName:c.Name})},{default:x(()=>[f(" 播放 ")]),_:2},1032,["onClick"]),e(t(te),{type:"vertical",class:"m-0"}),e(t(M),{size:"small",type:"link",danger:"",disabled:c.LiveStatus===0,onClick:()=>r(c)},{default:x(()=>[f(" 停止拉流 ")]),_:2},1032,["disabled","onClick"])]),_:1},8,["uid","gridOptions"])],64))}}),de=({row:a,appContext:o,pause:d,resume:l})=>{d();const{Name:u,Channels:r,ID:s}=a;Q({content:e(se,{detail:r||[],device:{ID:s,Name:u}},null),modalConfig:{appContext:o,width:"78%",title:`${u} 通道详情`,okButtonProps:{style:{display:"none"}},cancelText:"关闭",maskClosable:!1,onCancel:()=>l()}})},ce=g({name:"Device"}),be=g({...ce,setup(a){var P;const o=(P=K())==null?void 0:P.appContext;q.renderer.add("moreFields",{renderExpand(n,_){const{row:m}=_;return e("p",{class:"flex flex-col p-10px m-0"},[e("span",null,[e("b",null,[f("型号(Model):  ")]),m.Model]),e("span",null,[e("b",null,[f("纬度(Latitude):  ")]),m.Latitude]),e("span",null,[e("b",null,[f("经度(Longitude):  ")]),m.Longitude]),e("span",null,[e("b",null,[f("GpsTime:  ")]),m.GpsTime]),e("span",null,[e("b",null,[f("Owner:  ")]),m.Owner])])}});const d=ie(),l=N(()=>d.deviceList),{httpRefreshTime:u}=X({VITE_PORT:"3000",VITE_GLOB_APP_TITLE:"Monibuca Admin",VITE_GLOB_APP_SHORT_NAME:"m7s_admin",VITE_USE_MOCK:"true",VITE_PUBLIC_PATH:"/ui",VITE_DROP_CONSOLE:"true",VITE_BUILD_COMPRESS:"none",VITE_BUILD_COMPRESS_DELETE_ORIGIN_FILE:"false",VITE_GLOB_HTTP_REFRESH_TIME:"5000",VITE_USE_IMAGEMIN:"true",VITE_LEGACY:"false",VITE_M7S_SERVER:"",BASE_URL:"/ui",MODE:"production",DEV:!1,PROD:!0,SSR:!1}),{pause:r,resume:s}=J(C,u),i=n=>{const _=String(n.target.value).trim().toLowerCase();if(_){const m=new RegExp(_,"gi"),b=["ID","Name"],U=l.value.filter(D=>b.some(E=>String(D[E]).toLowerCase().indexOf(_)>-1)).map(D=>{const E=Object.assign({},D);return b.forEach(R=>{E[R]=String(E[R]).replace(m,$=>`<span style="color: #ff99a0">${$}</span>`)}),E});p(U),r()}else p(l.value),s()},{FormilyForm:c}=j({schema:oe(i)}),y={toggleRowExpand:({expanded:n})=>{n?r():s()}},h=H(),p=n=>{h.tableRef.reloadData(n)};async function C(){await d.fetchDeviceList(),p(d.deviceList)}C();const w={maxHeight:"100%",rowConfig:{keyField:"ID",useKey:!0},columnConfig:{useKey:!0},columns:[{title:"...",width:"30px",type:"expand",contentRender:{name:"moreFields"},fixed:"left"},{field:"ID",title:"设备编号",showOverflow:"tooltip",width:"200px",fixed:"left",type:"html"},{field:"Name",title:"设备名称",showOverflow:"tooltip",width:"120px",type:"html"},{field:"NetAddr",title:"网络地址",showOverflow:"tooltip",width:"180px"},{field:"Channels",title:"通道数",width:"70px",formatter:({cellValue:n})=>(n==null?void 0:n.length)||0},{field:"Status",title:"状态",minWidth:"120px"},{field:"Manufacturer",title:"厂商",width:"120px"},{field:"LastKeepaliveAt",title:"最后保活时间",minWidth:"180px",formatter:({cellValue:n})=>O.toDateString(new Date(n),"yyyy-MM-dd HH:ss:mm")},{field:"RegisterTime",title:"注册时间",minWidth:"180px",formatter:({cellValue:n})=>O.toDateString(new Date(n),"yyyy-MM-dd HH:ss:mm")},{field:"UpdateTime",title:"更新时间",minWidth:"180px",formatter:({cellValue:n})=>O.toDateString(new Date(n),"yyyy-MM-dd HH:ss:mm")},{field:"operate",title:"操作",width:"120px",fixed:"right",align:"center",slots:{default:"operate"}}],data:[]};return(n,_)=>(F(),k(B,null,[e(t(v),{bordered:!1,bodyStyle:{padding:"26px 10px 0 10px",marginBottom:"8px"}},{default:x(()=>[e(t(c))]),_:1}),e(t(v),{bordered:!1,bodyStyle:{padding:"10px",height:"calc(100% - 50px)"},style:{height:"calc(100% - 100px)"}},{default:x(()=>[e(t(W),{windowWidth:1716}),e(t(V),{uid:t(h).uid,gridOptions:t(w),gridEvent:t(y)},{operate:x(({row:m})=>[e(t(ae),null,{default:x(()=>[e(t(M),{size:"small",type:"link",onClick:()=>t(de)({row:m,appContext:t(o),pause:t(r),resume:t(s)})},{default:x(()=>[f(" 通道详情 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["uid","gridOptions","gridEvent"])]),_:1},8,["bodyStyle"])],64))}});export{be as default};
