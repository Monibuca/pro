import{d as y,f as e,e as H,k as G,w as J,S as F,a3 as N,V as p,u as t,E as f,W as C,F as $,g as Q}from"./vue-db0e7353.js";import{u as z,d as M,r as O,P as T,W as Z,ax as E,ay as U,B as A,az as K,aA as ee,a0 as te,aB as ae,aq as le,aC as P}from"./index-a3873c66.js";import{u as j}from"./index-8b532adb.js";import"./dayjs-4778c158.js";import{_ as q}from"./scroll-tip.vue_vue_type_script_setup_true_lang-3bd94e76.js";import{i as ie,s as W,a as ne,u as se}from"./device-f2176f90.js";import{D as oe,a as re,b as S,p as de}from"./index-6396b3d8.js";import{V as ce}from"./jb4-6a025928.js";import{C as h}from"./Card-3e30f616.js";import{D as ue}from"./index-e55b8189.js";import{S as pe}from"./index-e495502e.js";import"./mockjs-890b569b.js";import"./global-7782a904.js";import"./index-cfe68d2a.js";import"./useFlexGapSupport-a31804f7.js";var fe=function(){return{prefixCls:String,title:T.any,description:T.any,avatar:T.any}};const L=y({compatConfig:{MODE:3},name:"ACardMeta",props:fe(),slots:["title","description","avatar"],setup:function(a,o){var r=o.slots,u=z("card",a),n=u.prefixCls;return function(){var d=M({},"".concat(n.value,"-meta"),!0),l=O(r,a,"avatar"),c=O(r,a,"title"),v=O(r,a,"description"),_=l?e("div",{class:"".concat(n.value,"-meta-avatar")},[l]):null,m=c?e("div",{class:"".concat(n.value,"-meta-title")},[c]):null,D=v?e("div",{class:"".concat(n.value,"-meta-description")},[v]):null,I=m||D?e("div",{class:"".concat(n.value,"-meta-detail")},[m,D]):null;return e("div",{class:d},[_,I])}}});var me=function(){return{prefixCls:String,hoverable:{type:Boolean,default:!0}}};const R=y({compatConfig:{MODE:3},name:"ACardGrid",__ANT_CARD_GRID:!0,props:me(),setup:function(a,o){var r=o.slots,u=z("card",a),n=u.prefixCls,d=H(function(){var l;return l={},M(l,"".concat(n.value,"-grid"),!0),M(l,"".concat(n.value,"-grid-hoverable"),a.hoverable),l});return function(){var l;return e("div",{class:d.value},[(l=r.default)===null||l===void 0?void 0:l.call(r)])}}});h.Meta=L;h.Grid=R;h.install=function(i){return i.component(h.name,h),i.component(L.name,L),i.component(R.name,R),i};const ve=i=>({type:"object",properties:{layout:{type:"void","x-component":"FormLayout","x-component-props":{layout:"inline"},properties:{Name:{type:"string","x-decorator":"FormItem","x-decorator-props":{style:"margin-right: 10px;width: 260px"},"x-component":"Input","x-component-props":{placeholder:"请输入设备编号或名称搜索","@keyup":i},"x-content":{prefix:()=>e(Z,{icon:"ic:outline-search"},null)}}}}}}),xe={class:"h-full w-full flex flex-items-center"},he=y({__name:"play",props:{device:null,channel:null},setup(i){const a=i,o={fontWeight:"bold"},r=G("http-flv"),u=G("");J(()=>a.device.ID,l=>{if(l){const{DeviceID:c}=a.channel,v=a.device.ID;ie({id:v,channel:c}).finally(()=>{u.value=`${v}/${c}`})}},{immediate:!0});const n=async l=>{E.destroy();const{DeviceID:c}=a.channel;await W({id:a.device.ID,channel:c,ptzcmd:l}).then(async v=>{E.success("指令发送成功"),d()}).catch(v=>{E.success("指令发送失败")})},d=()=>{setTimeout(async()=>{const{DeviceID:l}=a.channel;await W({id:a.device.ID,channel:l,ptzcmd:de()})})};return(l,c)=>(F(),N("div",xe,[e(ce,{streamPath:u.value,format:r.value,class:"player flex-1 m-r-10px"},null,8,["streamPath","format"]),e(t(h),{bordered:!1,bodyStyle:{height:"100%",width:"250px"}},{default:p(()=>[e(oe,{hanldeClick:n,allowed:!!u.value},null,8,["allowed"]),e(t(re),{column:1,class:"mt-20px",layout:"vertical"},{default:p(()=>[e(t(S),{class:"!pb-8px",labelStyle:t(o),label:"设备名称"},{default:p(()=>[f(C(i.device.Name||"--"),1)]),_:1},8,["labelStyle"]),e(t(S),{class:"!pb-8px",labelStyle:t(o),label:"设备编号"},{default:p(()=>[f(C(i.device.ID||"--"),1)]),_:1},8,["labelStyle"]),e(t(S),{class:"!pb-8px",labelStyle:t(o),label:"通道名称"},{default:p(()=>[f(C(i.channel.Name||"--"),1)]),_:1},8,["labelStyle"]),e(t(S),{class:"!pb-8px",labelStyle:t(o),label:"通道编号"},{default:p(()=>[f(C(i.channel.DeviceID||"--"),1)]),_:1},8,["labelStyle"])]),_:1})]),_:1})]))}}),ye=({device:i,row:a})=>{U({content:()=>e(he,{channel:a,device:i},null),modalConfig:{width:"100%",wrapClassName:"full-play-modal",destroyOnClose:!0,footer:null}})},_e=y({name:"Channel"}),ge=y({..._e,props:{detail:null,device:null},setup(i){const a=i,o={0:"空闲",1:"拉流中",2:"已拉流"},r=j(),u={maxHeight:"530px",rowConfig:{keyField:"DeviceID",useKey:!0},columnConfig:{useKey:!0},columns:[{field:"DeviceID",title:"编号",showOverflow:"tooltip",width:"200px",fixed:"left"},{field:"Name",title:"名称",showOverflow:"tooltip",width:"120px",fixed:"left"},{field:"Status",title:"状态",minWidth:"100px"},{field:"LiveStatus",title:"拉流状态",minWidth:"120px",formatter:({cellValue:d})=>o[d]},{field:"Manufacturer",title:"厂商",width:"120px"},{field:"Address",title:"地址",showOverflow:"tooltip",width:"180px"},{field:"Port",title:"端口",width:"70px"},{field:"Model",title:"型号",width:"180px"},{field:"Owner",title:"Owner",width:"120px"},{field:"CivilCode",title:"CivilCode",width:"120px"},{field:"Parental",title:"Parental",width:"120px"},{field:"SafetyWay",title:"SafetyWay",width:"120px"},{field:"RegisterWay",title:"RegisterWay",width:"120px"},{field:"Secrecy",title:"Secrecy",width:"120px"},{field:"operate",title:"操作",width:"140px",slots:{default:"operate"},align:"center",fixed:"right"}],data:a.detail},n=async d=>{const{DeviceID:l,Name:c}=d;await ne({id:a.device.ID,channel:l}).then(v=>{const _=a.detail.map(m=>(m.DeviceID===l&&(m.LiveStatus=0),m));r.tableRef.reloadData(_),E.success(`通道 ${c||l} 已停止拉流`)})};return(d,l)=>(F(),N($,null,[e(t(q)),e(t(K),{uid:t(r).uid,gridOptions:t(u)},{operate:p(({row:c})=>[e(t(A),{size:"small",type:"link",onClick:()=>t(ye)({device:i.device,row:c})},{default:p(()=>[f(" 播放 ")]),_:2},1032,["onClick"]),e(t(ue),{type:"vertical",class:"m-0"}),e(t(A),{size:"small",type:"link",danger:"",disabled:c.LiveStatus===0,onClick:()=>n(c)},{default:p(()=>[f(" 停止拉流 ")]),_:2},1032,["disabled","onClick"])]),_:1},8,["uid","gridOptions"])],64))}});const De=({row:i,appContext:a,pause:o,resume:r})=>{o();const{Name:u,Channels:n,ID:d}=i;U({content:e(ge,{detail:n||[],device:{ID:d,Name:u}},null),modalConfig:{appContext:a,width:"78%",title:`${u} 通道详情`,okButtonProps:{style:{display:"none"}},cancelText:"关闭",maskClosable:!1,onCancel:()=>r()}})},we=y({name:"Device"}),Be=y({...we,setup(i){var k;const a=(k=Q())==null?void 0:k.appContext;ee.renderer.add("moreFields",{renderExpand(s,g){const{row:x}=g;return e("p",{class:"flex flex-col p-10px m-0"},[e("span",null,[e("b",null,[f("型号(Model):  ")]),x.Model]),e("span",null,[e("b",null,[f("纬度(Latitude):  ")]),x.Latitude]),e("span",null,[e("b",null,[f("经度(Longitude):  ")]),x.Longitude]),e("span",null,[e("b",null,[f("GpsTime:  ")]),x.GpsTime]),e("span",null,[e("b",null,[f("Owner:  ")]),x.Owner])])}});const o=se(),r=H(()=>o.deviceList),{httpRefreshTime:u}=te({VITE_PORT:"3000",VITE_GLOB_APP_TITLE:"Monibuca Admin",VITE_GLOB_APP_SHORT_NAME:"m7s_admin",VITE_USE_MOCK:"true",VITE_PUBLIC_PATH:"/ui",VITE_DROP_CONSOLE:"true",VITE_BUILD_COMPRESS:"none",VITE_BUILD_COMPRESS_DELETE_ORIGIN_FILE:"false",VITE_GLOB_HTTP_REFRESH_TIME:"5000",VITE_USE_IMAGEMIN:"true",VITE_LEGACY:"false",VITE_M7S_SERVER:"",BASE_URL:"/ui",MODE:"production",DEV:!1,PROD:!0,SSR:!1}),{pause:n,resume:d}=ae(D,u),l=s=>{const g=String(s.target.value).trim().toLowerCase();if(g){const x=new RegExp(g,"gi"),V=["ID","Name"],X=r.value.filter(b=>V.some(w=>String(b[w]).toLowerCase().indexOf(g)>-1)).map(b=>{const w=Object.assign({},b);return V.forEach(B=>{w[B]=String(w[B]).replace(x,Y=>`<span style="color: #ff99a0">${Y}</span>`)}),w});m(X),n()}else m(r.value),d()},{FormilyForm:c}=le({schema:ve(l)}),v={toggleRowExpand:({expanded:s})=>{s?n():d()}},_=j(),m=s=>{_.tableRef.reloadData(s)};async function D(){await o.fetchDeviceList(),m(o.deviceList)}D();const I={maxHeight:"100%",rowConfig:{keyField:"ID",useKey:!0},columnConfig:{useKey:!0},columns:[{title:"...",width:"30px",type:"expand",contentRender:{name:"moreFields"},fixed:"left"},{field:"ID",title:"设备编号",showOverflow:"tooltip",width:"200px",fixed:"left",type:"html"},{field:"Name",title:"设备名称",showOverflow:"tooltip",width:"120px",type:"html"},{field:"NetAddr",title:"网络地址",showOverflow:"tooltip",width:"180px"},{field:"Channels",title:"通道数",width:"70px",formatter:({cellValue:s})=>(s==null?void 0:s.length)||0},{field:"Status",title:"状态",minWidth:"120px"},{field:"Manufacturer",title:"厂商",width:"120px"},{field:"LastKeepaliveAt",title:"最后保活时间",minWidth:"180px",formatter:({cellValue:s})=>P.toDateString(new Date(s),"yyyy-MM-dd HH:ss:mm")},{field:"RegisterTime",title:"注册时间",minWidth:"180px",formatter:({cellValue:s})=>P.toDateString(new Date(s),"yyyy-MM-dd HH:ss:mm")},{field:"UpdateTime",title:"更新时间",minWidth:"180px",formatter:({cellValue:s})=>P.toDateString(new Date(s),"yyyy-MM-dd HH:ss:mm")},{field:"operate",title:"操作",width:"120px",fixed:"right",slots:{default:"operate"}}],data:[]};return(s,g)=>(F(),N($,null,[e(t(h),{bordered:!1,bodyStyle:{padding:"26px 10px 0 10px",marginBottom:"8px"}},{default:p(()=>[e(t(c))]),_:1}),e(t(h),{bordered:!1,bodyStyle:{padding:"10px",height:"calc(100% - 50px)"},style:{height:"calc(100% - 100px)"}},{default:p(()=>[e(t(q),{windowWidth:1716}),e(t(K),{uid:t(_).uid,gridOptions:t(I),gridEvent:t(v)},{operate:p(({row:x})=>[e(t(pe),null,{default:p(()=>[e(t(A),{size:"small",type:"link",onClick:()=>t(De)({row:x,appContext:t(a),pause:t(n),resume:t(d)})},{default:p(()=>[f(" 通道详情 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["uid","gridOptions","gridEvent"])]),_:1},8,["bodyStyle"])],64))}});export{Be as default};
