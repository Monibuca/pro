import{d as I,k as _,s as K,o as T,b as M,S as c,a3 as C,t as A,A as B,f as l,u as e,ac as p,V as d,a6 as N,e as O,w,P as W,x as Y,U as u,F as G,_ as H,a4 as J}from"./vue-db0e7353.js";import"./dayjs-4778c158.js";import{bh as Q,bi as X,W as m,ae as E,ad as Z,bj as ee}from"./index-a3873c66.js";import{_ as se}from"./index.vue_vue_type_script_setup_true_lang-d9538b62.js";import{u as te,a as oe}from"./usePlay-09a5eb25.js";import{i as le}from"./device-f2176f90.js";import{C as L,R as ae,a as ne}from"./Card-3e30f616.js";import{D as $}from"./index-e55b8189.js";import{S as re}from"./index-a243efec.js";import{a as ce}from"./index-f29645b2.js";import"./mockjs-890b569b.js";import"./global-7782a904.js";import"./useFlexGapSupport-a31804f7.js";const ie={class:"video-player-container"},ue=I({__name:"video",props:{title:null,stream:null},setup(y){const o=y,s=_();function f(){o.stream&&s.value&&o.stream.mediaStream&&(s.value.srcObject=o.stream.mediaStream)}K(()=>{var n;o.stream&&(f(),(n=o.stream)==null||n.on("change",f))});const v=_(!0);T(()=>{Q(s.value,"canplay",()=>{v.value=!1})}),M(()=>{var n;(n=o.stream)==null||n.off("change",f)});const x=()=>document.querySelector(".video-player-container");return(n,b)=>(c(),C("div",ie,[A(l(e(X),{class:"loading"},null,512),[[B,v.value]]),p("video",{class:"player",ref_key:"videoEle",ref:s,autoplay:""},null,512),l(e(E),{class:"info",title:y.title,getPopupContainer:x},{default:d(()=>[l(e(m),{icon:"octicon:ellipsis-16",size:20,color:"#dedede",hoverColor:"#9dcefc"})]),_:1},8,["title"])]))}});const de={class:"cursor-pointer fixed top-46% left-0 z-10 flex flex-col bg-black dark:bg-#333 color-#fff p-4px rounded-r-4px"},me={class:"p-16px pb-0"},pe={class:"mb-8px flex items-center"},fe=p("label",{class:"w-70px text-right"},"分屏总数  ",-1),ve={class:"flex items-center"},_e=p("label",{class:"w-70px text-right"},"每行屏数  ",-1),ye={key:1,class:"video-player-placeholder"},xe=I({name:"ScreenLarge"}),Be=I({...xe,setup(y){const o=te(),{customInfo:s}=N(o),f=O(()=>24/s.value.rowNum),v=()=>{o.setCustomInfo({collapsed:!s.value.collapsed})},x=_({1:"1",2:"2",3:"3",4:"4",6:"6",8:"8",12:"12",24:"24"}),{getActiveInfo:n}=N(o),{updateItem:b,streamList:F,changeStreamList:P,closeAll:R}=oe();w(()=>s.value.screenNum,async()=>{o.setCustomInfo({selectNum:0}),o.setActiveInfo({ID:"",DeviceID:"",DeviceName:"",Name:"",LiveStatus:0});const r=new Array(s.value.screenNum).fill({}).map(()=>({path:""}));P(r)},{immediate:!0}),w(()=>e(n),(r,a)=>{const{ID:t,DeviceID:i}=n.value,k=`${r.ID}/${r.DeviceID}`,g=`${a.ID}/${a.DeviceID}`;r.DeviceID&&k!==g&&le({id:t,channel:i}).finally(()=>{b(n.value,s.value.selectNum)})});const U=()=>document.querySelector(".video-player-placeholder"),D=_(null),{toggle:S,isFullscreen:h}=Z(D),z=r=>{const{ID:a,DeviceID:t,DeviceName:i,Name:k,LiveStatus:g}=r;o.setActiveInfo({ID:a,DeviceID:t,DeviceName:i,Name:k,LiveStatus:g})},V=r=>{o.setCustomInfo({selectNum:r})},j=W(),q=()=>{j.go(-1)};return Y(()=>{R()}),(r,a)=>(c(),u(e(ce),{id:"screen-custom",ref_key:"screenCustom",ref:D,class:"h-full w-full flex flex-row"},{default:d(()=>[p("div",de,[l(e(m),{onClick:q,icon:"entypo:back",class:"v-middle"}),l(e($),{class:"mx-0 my-4px border-color-#fff"}),e(s).collapsed?(c(),u(e(m),{key:1,onClick:v,icon:"icon-park-solid:expand-left",class:"v-middle"})):(c(),u(e(m),{key:0,onClick:v,icon:"icon-park-solid:expand-right",class:"v-middle"})),l(e($),{class:"mx-0 my-4px border-color-#fff"}),e(h)?(c(),u(e(m),{key:3,icon:"ant-design:fullscreen-exit-outlined",class:"v-text-bottom",onClick:e(S)},null,8,["onClick"])):(c(),u(e(m),{key:2,icon:"ant-design:fullscreen-outlined",class:"v-text-bottom",onClick:e(S)},null,8,["onClick"]))]),A(l(e(L),{class:"w-342px m-r-8px h-full",bordered:!1,bodyStyle:{height:"100%",padding:0}},{default:d(()=>[p("div",me,[p("div",pe,[fe,l(e(ee),{value:e(s).screenNum,"onUpdate:value":a[0]||(a[0]=t=>e(s).screenNum=t),min:1,style:{flex:"1"},onChange:a[1]||(a[1]=t=>e(o).setCustomInfo({screenNum:t}))},null,8,["value"])]),p("div",ve,[_e,l(e(re),{class:"flex-1",value:e(s).rowNum,"onUpdate:value":a[2]||(a[2]=t=>e(s).rowNum=t),min:1,max:24,step:null,marks:x.value,onChange:a[3]||(a[3]=t=>e(o).setCustomInfo({rowNum:t}))},null,8,["value","step","marks"])])]),l(se,{onSelect:z})]),_:1},512),[[B,!e(s).collapsed]]),l(e(L),{style:{height:"100%",flex:"1"},bordered:!1,bodyStyle:{height:"100%",overflowY:"scroll",padding:"8px"}},{default:d(()=>[l(e(ae),{gutter:4,ref:"screenRef"},{default:d(()=>[(c(!0),C(G,null,H(e(F),(t,i)=>(c(),u(e(ne),{span:e(f),key:i,class:J(["mt-4px flex-center",{active:e(s).screenNum>1&&e(s).selectNum===i&&!e(h),isFullscreen:e(h)}]),onClick:()=>V(i)},{default:d(()=>[t!=null&&t.stream?(c(),u(ue,{key:0,title:t.path,stream:t.stream},null,8,["title","stream"])):(c(),C("div",ye,[l(e(E),{title:"当前无信号，请先选择通道",class:"tip cursor-pointer",getPopupContainer:U},{default:d(()=>[l(e(m),{icon:"pepicons-pop:television-play-off",size:30})]),_:1})]))]),_:2},1032,["span","class","onClick"]))),128))]),_:1},512)]),_:1})]),_:1},512))}});export{Be as default};
