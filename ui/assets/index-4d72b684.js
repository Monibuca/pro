import{d as _,f as e,e as H,u as t,S as I,a3 as b,E as f,ab as J,k as W,w as Q,V as p,W as C,F as $,g as ee}from"./vue-12defb16.js";import{u as z,d as L,r as P,P as M,az as te,Z as U,aA as E,aB as K,B as R,aC as j,aD as ae,a3 as ie,aE as le,as as ne,aF as A}from"./index-c0a17768.js";import{u as q}from"./index-b725aad8.js";import"./dayjs-4778c158.js";import{i as se,s as G,a as oe,u as re}from"./device-fff3723f.js";import{D as de,a as ce,b as S,p as ue}from"./index-01110c73.js";import{V as pe}from"./jb4-70687058.js";import{C as x}from"./Card-78023e69.js";import{D as fe}from"./index-8b1011e4.js";import{S as me}from"./index-d94df19e.js";import"./mockjs-890b569b.js";import"./overview-6a65cc93.js";import"./index-c5bbdf96.js";import"./useFlexGapSupport-563fd2e9.js";var ve=function(){return{prefixCls:String,title:M.any,description:M.any,avatar:M.any}};const F=_({compatConfig:{MODE:3},name:"ACardMeta",props:ve(),slots:["title","description","avatar"],setup:function(a,n){var o=n.slots,u=z("card",a),s=u.prefixCls;return function(){var d=L({},"".concat(s.value,"-meta"),!0),l=P(o,a,"avatar"),c=P(o,a,"title"),v=P(o,a,"description"),y=l?e("div",{class:"".concat(s.value,"-meta-avatar")},[l]):null,m=c?e("div",{class:"".concat(s.value,"-meta-title")},[c]):null,w=v?e("div",{class:"".concat(s.value,"-meta-description")},[v]):null,O=m||w?e("div",{class:"".concat(s.value,"-meta-detail")},[m,w]):null;return e("div",{class:d},[y,O])}}});var he=function(){return{prefixCls:String,hoverable:{type:Boolean,default:!0}}};const N=_({compatConfig:{MODE:3},name:"ACardGrid",__ANT_CARD_GRID:!0,props:he(),setup:function(a,n){var o=n.slots,u=z("card",a),s=u.prefixCls,d=H(function(){var l;return l={},L(l,"".concat(s.value,"-grid"),!0),L(l,"".concat(s.value,"-grid-hoverable"),a.hoverable),l});return function(){var l;return e("div",{class:d.value},[(l=o.default)===null||l===void 0?void 0:l.call(o)])}}});x.Meta=F;x.Grid=N;x.install=function(i){return i.component(x.name,x),i.component(F.name,F),i.component(N.name,N),i};const xe={key:0},X=_({__name:"scroll-tip",props:{windowWidth:{type:Number,default:1/0}},setup(i){const a=i,{width:n}=te();return(o,u)=>t(n)<a.windowWidth?(I(),b("p",xe,[e(U,{icon:"ic:baseline-tips-and-updates",class:"v-text-bottom"}),f(" 当列表出现横向滚动条时，windows可通过【按住shift键+鼠标滚轮】mac通过【在鼠标上左右滑动】来快速查看 ")])):J("",!0)}}),_e=i=>({type:"object",properties:{layout:{type:"void","x-component":"FormLayout","x-component-props":{layout:"inline"},properties:{Name:{type:"string","x-decorator":"FormItem","x-decorator-props":{style:"margin-right: 10px;width: 260px"},"x-component":"Input","x-component-props":{placeholder:"请输入设备编号或名称搜索","@keyup":i},"x-content":{prefix:()=>e(U,{icon:"ic:outline-search"},null)}}}}}}),ye={class:"h-full w-full flex flex-items-center"},ge=_({__name:"play",props:{device:null,channel:null},setup(i){const a=i,n={fontWeight:"bold"},o=W("flv"),u=W("");Q(()=>a.device.ID,l=>{if(l){const{DeviceID:c}=a.channel,v=a.device.ID;se({id:v,channel:c}).finally(()=>{u.value=`${v}/${c}`})}},{immediate:!0});const s=async l=>{E.destroy();const{DeviceID:c}=a.channel;await G({id:a.device.ID,channel:c,ptzcmd:l}).then(async v=>{E.success("指令发送成功"),d()}).catch(v=>{E.success("指令发送失败")})},d=()=>{setTimeout(async()=>{const{DeviceID:l}=a.channel;await G({id:a.device.ID,channel:l,ptzcmd:ue()})})};return(l,c)=>(I(),b("div",ye,[e(pe,{streamPath:u.value,format:o.value,class:"player flex-1 m-r-10px"},null,8,["streamPath","format"]),e(t(x),{bordered:!1,bodyStyle:{height:"100%",width:"250px"}},{default:p(()=>[e(de,{hanldeClick:s,allowed:!!u.value},null,8,["allowed"]),e(t(ce),{column:1,class:"mt-20px",layout:"vertical"},{default:p(()=>[e(t(S),{class:"!pb-8px",labelStyle:t(n),label:"设备名称"},{default:p(()=>[f(C(i.device.Name||"--"),1)]),_:1},8,["labelStyle"]),e(t(S),{class:"!pb-8px",labelStyle:t(n),label:"设备编号"},{default:p(()=>[f(C(i.device.ID||"--"),1)]),_:1},8,["labelStyle"]),e(t(S),{class:"!pb-8px",labelStyle:t(n),label:"通道名称"},{default:p(()=>[f(C(i.channel.Name||"--"),1)]),_:1},8,["labelStyle"]),e(t(S),{class:"!pb-8px",labelStyle:t(n),label:"通道编号"},{default:p(()=>[f(C(i.channel.DeviceID||"--"),1)]),_:1},8,["labelStyle"])]),_:1})]),_:1})]))}}),we=({device:i,row:a})=>{K({content:()=>e(ge,{channel:a,device:i},null),modalConfig:{width:"100%",wrapClassName:"full-play-modal",destroyOnClose:!0,footer:null}})},De=_({name:"Channel"}),Ce=_({...De,props:{detail:null,device:null},setup(i){const a=i,n={0:"空闲",1:"拉流中",2:"已拉流"},o=q(),u={maxHeight:"530px",rowConfig:{keyField:"DeviceID",useKey:!0},columnConfig:{useKey:!0},columns:[{field:"DeviceID",title:"编号",showOverflow:"tooltip",width:"200px",fixed:"left"},{field:"Name",title:"名称",showOverflow:"tooltip",width:"120px",fixed:"left"},{field:"Status",title:"状态",minWidth:"100px"},{field:"LiveStatus",title:"拉流状态",minWidth:"120px",formatter:({cellValue:d})=>n[d]},{field:"Manufacturer",title:"厂商",width:"120px"},{field:"Address",title:"地址",showOverflow:"tooltip",width:"180px"},{field:"Port",title:"端口",width:"70px"},{field:"Model",title:"型号",width:"180px"},{field:"Owner",title:"Owner",width:"120px"},{field:"CivilCode",title:"CivilCode",width:"120px"},{field:"Parental",title:"Parental",width:"120px"},{field:"SafetyWay",title:"SafetyWay",width:"120px"},{field:"RegisterWay",title:"RegisterWay",width:"120px"},{field:"Secrecy",title:"Secrecy",width:"120px"},{field:"operate",title:"操作",width:"140px",slots:{default:"operate"},align:"center",fixed:"right"}],data:a.detail},s=async d=>{const{DeviceID:l,Name:c}=d;await oe({id:a.device.ID,channel:l}).then(v=>{const y=a.detail.map(m=>(m.DeviceID===l&&(m.LiveStatus=0),m));o.tableRef.reloadData(y),E.success(`通道 ${c||l} 已停止拉流`)})};return(d,l)=>(I(),b($,null,[e(t(X)),e(t(j),{uid:t(o).uid,gridOptions:t(u)},{operate:p(({row:c})=>[e(t(R),{size:"small",type:"link",onClick:()=>t(we)({device:i.device,row:c})},{default:p(()=>[f(" 播放 ")]),_:2},1032,["onClick"]),e(t(fe),{type:"vertical",class:"m-0"}),e(t(R),{size:"small",type:"link",danger:"",disabled:c.LiveStatus===0,onClick:()=>s(c)},{default:p(()=>[f(" 停止拉流 ")]),_:2},1032,["disabled","onClick"])]),_:1},8,["uid","gridOptions"])],64))}});const Se=({row:i,appContext:a,pause:n,resume:o})=>{n();const{Name:u,Channels:s,ID:d}=i;K({content:e(Ce,{detail:s||[],device:{ID:d,Name:u}},null),modalConfig:{appContext:a,width:"78%",title:`${u} 通道详情`,okButtonProps:{style:{display:"none"}},cancelText:"关闭",maskClosable:!1,onCancel:()=>o()}})},Ee=_({name:"Device"}),Ge=_({...Ee,setup(i){var k;const a=(k=ee())==null?void 0:k.appContext;ae.renderer.add("moreFields",{renderExpand(r,g){const{row:h}=g;return e("p",{class:"flex flex-col p-10px m-0"},[e("span",null,[e("b",null,[f("型号(Model):  ")]),h.Model]),e("span",null,[e("b",null,[f("纬度(Latitude):  ")]),h.Latitude]),e("span",null,[e("b",null,[f("经度(Longitude):  ")]),h.Longitude]),e("span",null,[e("b",null,[f("GpsTime:  ")]),h.GpsTime]),e("span",null,[e("b",null,[f("Owner:  ")]),h.Owner])])}});const n=re(),o=H(()=>n.deviceList),{httpRefreshTime:u}=ie({VITE_PORT:"3000",VITE_GLOB_APP_TITLE:"Monibuca Admin",VITE_GLOB_APP_SHORT_NAME:"m7s_admin",VITE_USE_MOCK:"true",VITE_PUBLIC_PATH:"/ui",VITE_DROP_CONSOLE:"true",VITE_BUILD_COMPRESS:"none",VITE_BUILD_COMPRESS_DELETE_ORIGIN_FILE:"false",VITE_GLOB_HTTP_REFRESH_TIME:"5000",VITE_USE_IMAGEMIN:"true",VITE_LEGACY:"false",VITE_M7S_SERVER:"",BASE_URL:"/ui",MODE:"production",DEV:!1,PROD:!0,SSR:!1}),{pause:s,resume:d}=le(w,u),l=r=>{const g=String(r.target.value).trim().toLowerCase();if(g){const h=new RegExp(g,"gi"),V=["ID","Name"],Y=o.value.filter(T=>V.some(D=>String(T[D]).toLowerCase().indexOf(g)>-1)).map(T=>{const D=Object.assign({},T);return V.forEach(B=>{D[B]=String(D[B]).replace(h,Z=>`<span style="color: #ff99a0">${Z}</span>`)}),D});m(Y),s()}else m(o.value),d()},{FormilyForm:c}=ne({schema:_e(l)}),v={toggleRowExpand:({expanded:r})=>{r?s():d()}},y=q(),m=r=>{y.tableRef.reloadData(r)};async function w(){await n.fetchDeviceList(),m(n.deviceList)}w();const O={maxHeight:"100%",rowConfig:{keyField:"ID",useKey:!0},columnConfig:{useKey:!0},columns:[{title:"...",width:"30px",type:"expand",contentRender:{name:"moreFields"},fixed:"left"},{field:"ID",title:"设备编号",showOverflow:"tooltip",width:"200px",fixed:"left",type:"html"},{field:"Name",title:"设备名称",showOverflow:"tooltip",width:"120px",type:"html"},{field:"NetAddr",title:"网络地址",showOverflow:"tooltip",width:"180px"},{field:"Channels",title:"通道数",width:"70px",formatter:({cellValue:r})=>(r==null?void 0:r.length)||0},{field:"Status",title:"状态",minWidth:"120px"},{field:"Manufacturer",title:"厂商",width:"120px"},{field:"LastKeepaliveAt",title:"最后保活时间",minWidth:"180px",formatter:({cellValue:r})=>A.toDateString(new Date(r),"yyyy-MM-dd HH:ss:mm")},{field:"RegisterTime",title:"注册时间",minWidth:"180px",formatter:({cellValue:r})=>A.toDateString(new Date(r),"yyyy-MM-dd HH:ss:mm")},{field:"UpdateTime",title:"更新时间",minWidth:"180px",formatter:({cellValue:r})=>A.toDateString(new Date(r),"yyyy-MM-dd HH:ss:mm")},{field:"operate",title:"操作",width:"120px",fixed:"right",slots:{default:"operate"}}],data:[]};return(r,g)=>(I(),b($,null,[e(t(x),{bordered:!1,bodyStyle:{padding:"26px 10px 0 10px",marginBottom:"8px"}},{default:p(()=>[e(t(c))]),_:1}),e(t(x),{bordered:!1,bodyStyle:{padding:"10px",height:"calc(100% - 50px)"},style:{height:"calc(100% - 100px)"}},{default:p(()=>[e(t(X),{windowWidth:1716}),e(t(j),{uid:t(y).uid,gridOptions:t(O),gridEvent:t(v)},{operate:p(({row:h})=>[e(t(me),null,{default:p(()=>[e(t(R),{size:"small",type:"link",onClick:()=>t(Se)({row:h,appContext:t(a),pause:t(s),resume:t(d)})},{default:p(()=>[f(" 通道详情 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["uid","gridOptions","gridEvent"])]),_:1},8,["bodyStyle"])],64))}});export{Ge as default};
