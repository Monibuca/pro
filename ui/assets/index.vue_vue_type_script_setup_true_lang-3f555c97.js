import{d as T,k as c,s as A,U as i,V as k,a8 as g,f,$ as _,u as o,W as w,E as S,a4 as v,_ as B,F as N}from"./vue-c6b19427.js";import"./dayjs-4778c158.js";import{J as b,x as P}from"./index-aad18627.js";import{u as z}from"./device-1080b82d.js";import{I as J,a as U}from"./index-e6a754fb.js";import{D as W}from"./index-7f8dfd5e.js";const $={class:"p-16px"},j={class:"m-16px overscroll-contain overflow-y-auto overflow-x-hidden",style:{"max-height":"calc(100% - 64px)"}},q={class:"text-red"},Y=T({__name:"index",props:{single:{type:Boolean,default:!1}},emits:["select"],setup(C,{emit:E}){const I=C,x=z();x.fetchdeviceTree();const m=c([]),K=e=>e.key.includes("-")&&e.hasOwnProperty("LiveStatus"),O=(e,t)=>{const a=l.value.filter(s=>s!==e[0]);a.length<l.value.length?l.value=a:l.value=l.value.concat(e),I.single&&K(t.node)&&(m.value=[t.node.key]),E("select",t.node)},r=c(""),l=c([]),h=c(!0),V=e=>{l.value=e,h.value=!1},u=c([]),d=(e,t)=>{let a;if(!(t!=null&&t.length))return a;for(let s=0;s<t.length;s++){const n=t[s];n.children&&(n.children.some(p=>p.key===e)?a=n.key:d(e,n.children)&&(a=d(e,n.children)))}return a};let y=[];const D=e=>{const t=y.map(a=>a.title.indexOf(e)>-1?d(a.key,u.value):null).filter((a,s,n)=>a&&n.indexOf(a)===s);l.value=t,r.value=e,h.value=!0},F=P(e=>D(e.target.value),250);return A(()=>{if(u.value=x.deviceTree,y=x.deviceArr,I.single){for(let e of y)if(K(e)){m.value=[e.key],l.value=[d(e.key,u.value)],E("select",e);break}}}),(e,t)=>(i(),k(N,null,[g("div",$,[f(o(J),{placeholder:"模糊搜索设备名称",allowClear:"",onInput:o(F)},{prefix:_(()=>[f(o(b),{icon:"ic:outline-search"})]),_:1},8,["onInput"])]),f(o(W),{class:"m0"}),g("div",j,[f(o(U),{showIcon:"","tree-data":u.value,defaultExpandAll:"","expanded-keys":l.value,"auto-expand-parent":h.value,onExpand:V,selectedKeys:m.value,onSelect:O},{title:_(({title:a,isLeaf:s,disabled:n,DeviceID:p})=>[a.indexOf(r.value)>-1?(i(),k("span",{key:0,class:w({"text-primary":!n&&s&&p})},[S(v(a.substr(0,a.indexOf(r.value)))+" ",1),g("span",q,v(r.value),1),S(" "+v(a.substr(a.indexOf(r.value)+r.value.length)),1)],2)):(i(),k("span",{key:1,onClick:t[0]||(t[0]=L=>O("test",L)),class:w({"text-primary":!n&&s&&p})},v(a),3))]),icon:_(({isLeaf:a,DeviceID:s,disabled:n})=>[a&&s?(i(),B(o(b),{key:0,icon:"mdi:web-camera",class:w(["v-text-bottom",{"text-primary":!n}])},null,8,["class"])):(i(),B(o(b),{key:1,icon:"icon-park-solid:tree-diagram",class:"v-text-bottom rotate-90"}))]),_:1},8,["tree-data","expanded-keys","auto-expand-parent","selectedKeys"])])],64))}});export{Y as _};
